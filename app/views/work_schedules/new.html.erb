<%= render "layouts/user_header"%>

<div class="background">
  <div class="make-user-sub">
    <%# <div class="calender-list"> %>
      <%# 今月カレンダー %>
      <div class="shift-calender">
        <div class="page-head">
          <div class="current-user-name">
            <%= current_user.name %>
          </div>
          <div class="current-month-title">
            <div class="sub-title"><%= @today.strftime('%Y年%m月') %></div>
          </div>
        </div>
        <table class="shift-table">
          <tr>
            <th class="current-month-sun">日</th>
            <th class="current-month">月</th>
            <th class="current-month">火</th>
            <th class="current-month">水</th>
            <th class="current-month">木</th>
            <th class="current-month">金</th>
            <th class="current-month-sat">土</th>
          </tr>
          <% @start_month = @today.at_beginning_of_month.at_beginning_of_week - 1 %> <%# 今月の最初の週の日曜日の日付 %>
          <%# ７*５の表にカレンダーを作成 %>
          <% 35.times do |i|%>
            <%# 週初めに<tr>開始タグをつける %>
            <% if i % 7 == 0 %>
              <tr>
            <% end %>
            <%# 先月・来月には個別のclass属性を付与 %>
            <% if @start_month.month == @today.month - 1 || @start_month.month == @today.month + 1 %>
              <% if @start_month.wday == 0 %>
                <td class="prev-next-month-sun"><%= @start_month.strftime("%d").to_i %></td>
              <% elsif @start_month.wday == 6 %>
                <td class="prev-next-month-sat"><%= @start_month.strftime("%d").to_i %></td>
              <% else%>
                <td class="prev-next-month"><%= @start_month.strftime("%d").to_i %></td>
              <% end %>
            <% else %>
              <%# 今月に確定シフトを表示 %>
              <% if @start_month.wday == 0 %>
                <td class="current-month-sun-num">
                  <%= render "layouts/user_work_schedules_calender", locals: { works: @works, start_month: @start_month } %>
                </td>
              <% elsif @start_month.wday == 6%>
                <td class="current-month-sat-num">
                  <%= render "layouts/user_work_schedules_calender", locals: { works: @works, start_month: @start_month } %>
                </td>
              <% else %>
                <td class="current-month-num">
                  <%= render "layouts/user_work_schedules_calender", locals: { works: @works, start_month: @start_month } %>
                </td>
              <% end %>
            <% end %>
            <%# 週終わりに</tr>閉じタグをつける %>
            <% if i % 7 == 6 %>
              </tr>
            <% end %>
            <% @start_month += 1 %>
          <% end %>
        </table>
      </div>
      <%# 来月カレンダー %>
      <div class="shift-calender">
        <div class="current-month-title">
          <div class="sub-title"><%= @today.next_month.beginning_of_month.strftime('%Y年%m月') %></div>
        </div>
        <table class="shift-table">
          <tr>
            <th class="current-month-sun">日</th>
            <th class="current-month">月</th>
            <th class="current-month">火</th>
            <th class="current-month">水</th>
            <th class="current-month">木</th>
            <th class="current-month">金</th>
            <th class="current-month-sat">土</th>
          </tr>
          <% @start_next_month = @today.next_month.at_beginning_of_month.at_beginning_of_week - 1 %> <%# 来月の最初の週の日曜日の日付 %>
          <%# ７*５の表にカレンダーを作成 %>
          <% 35.times do |i|%>
            <%# 週初めに<tr>開始タグをつける %>
            <% if i % 7 == 0 %>
              <tr>
            <% end %>
            <%# 先月・来月には個別のclass属性を付与 %>
            <% if @start_next_month.month == @today.next_month.month - 1 || @start_next_month.month == @today.next_month.month + 1 %>
              <% if @start_next_month.wday == 0 %>
                <td class="prev-next-month-sun"><%= @start_next_month.strftime("%d").to_i %></td>
              <% elsif @start_next_month.wday == 6 %>
                <td class="prev-next-month-sat"><%= @start_next_month.strftime("%d").to_i %></td>
              <% else%>
                <td class="prev-next-month"><%= @start_next_month.strftime("%d").to_i %></td>
              <% end %>
            <% else %>
              <%# 今月に確定シフトを表示 %>
              <% if @start_next_month.wday == 0 %>
                <td class="current-month-sun-num">
                  <%= render "layouts/user_work_schedules_next_calender", locals: { works: @works, start_next_month: @start_next_month } %>
                </td>
              <% elsif @start_next_month.wday == 6%>
                <td class="current-month-sat-num">
                  <%= render "layouts/user_work_schedules_next_calender", locals: { works: @works, start_next_month: @start_next_month } %>
                </td>
              <% else %>
                <td class="current-month-num">
                  <%= render "layouts/user_work_schedules_next_calender", locals: { works: @works, start_next_month: @start_next_month } %>
                </td>
              <% end %>
            <% end %>
            <%# 週終わりに</tr>閉じタグをつける %>
            <% if i % 7 == 6 %>
              </tr>
            <% end %>
            <% @start_next_month += 1 %>
          <% end %>
        </table>
      </div>
    <%# </div> %>

    <%# シフト希望入力フォーム %>
    <%= form_with model:@schedules, url: work_schedules_path, class: 'make-shift', local: true do |f| %>
      <div class='new-form-wrap'>
        <div class='form-header-text'>
          <h1>シフト希望申請</h1>
        </div>
        <% ns = @today.days_since(14) %>
        <% ns_date = ns.beginning_of_week.day %>
        <% wday = ns.beginning_of_week.wday %>
        <%= f.fields_for :collections do |i| %>
          <% wdays = [ "(日)",  "(月)", "(火)", "(水)", "(木)", "(金)", "(土)"]%>
          <%= render 'layouts/error_messages', model: i.object %>
          <div class="shift-form">
            <div class="form-day">
              <%= "#{ns.beginning_of_month.month}/#{ns_date}#{wdays[wday]}" %>
            </div>
            <div class="form-group">
              <%= i.datetime_select :datetime_in, {discard_year: true, discard_month: true, minute_step: 30, use_month_numbers: true, default: { year: @today.next_week.next_week.beginning_of_month.year, month: @today.next_week.next_week.beginning_of_month.month, day: @today.next_week.next_week.beginning_of_month.day + 0.hour}}, {class: "select-form"} %>
            </div>
            <div>~</div>
            <div class="form-group">
              <%= i.datetime_select :datetime_out, {discard_year: true, discard_month: true, minute_step: 30, use_month_numbers: true, default: { year: @today.next_week.next_week.beginning_of_month.year, month: @today.next_week.next_week.beginning_of_month.month, day: @today.next_week.next_week.beginning_of_month.day + 0.hour}}, {class: "select-form"} %>
            </div>
            <div class="form-group">
              <div class="check-box-form">
                <%= i.check_box :holiday, as: :boolean, class:"check-box" %>
                <div class="form-text">
                  <label>休み</label>
                </div>
              </div>
            </div>
            <% ns += 1 %>
            <% ns_date += 1 %>
            <% wday += 1 %>
            <% if wday == 7 %>
              <% wday = 0 %>
            <% end %>
          </div>
        <% end %>
        <div class="form-group">
          <div class="comment">
            <label>コメント</label>
          </div>
          <%= f.text_area :add_request, placeholder:"コメントする", maxlength:"40", class:"comment-area" %>
        </div>
        <div class='form-group'>
          <%= f.submit "送信", class:"submit-btn" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<%= render "layouts/user_footer"%>